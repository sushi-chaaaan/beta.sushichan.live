---
import { declareLet } from "../../utils/declareLet";
import WithCaption from "../common/WithCaption.astro";
import CloudinaryImage, {
  type Props as CloudinaryImageProps,
} from "../ui/CloudinaryImage.astro";

type Props = CloudinaryImageProps;

const { alt: rawAlt, src, title: rawTitle, ...props } = Astro.props;

const { alt, title } = declareLet(() => {
  const typeSafeTitle = rawTitle === null ? undefined : rawTitle;
  const alt = rawAlt;
  const title = typeSafeTitle;
  return { alt, title };
});
---

<WithCaption caption={title} isFigure={false}>
  <CloudinaryImage
    alt={alt}
    class="rounded-lg content-visibility-auto"
    src={src}
    title={title}
    {...props}
  />
</WithCaption>
