---
import WithCaption from "@/components/common/WithCaption.astro"
import CloudinaryImage, {
  type Props as CloudinaryImageProps,
} from "@/components/ui/CloudinaryImage.astro"
import s from "@/components/utils/content-visibility.module.scss"
import { declareLet } from "@/utils/declareLet"

type Props = CloudinaryImageProps

const { alt: rawAlt, src, title: rawTitle, ...props } = Astro.props

const { alt, title } = declareLet(() => {
  const typeSafeTitle = rawTitle === null ? undefined : rawTitle
  const alt = rawAlt
  const title = typeSafeTitle
  return { alt, title }
})
---

<WithCaption caption={title} isFigure={false}>
  <CloudinaryImage
    alt={alt}
    class:list={["rounded-lg", s.root]}
    src={src}
    title={title}
    {...props}
  />
</WithCaption>
