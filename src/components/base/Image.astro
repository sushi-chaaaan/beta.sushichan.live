---
import { Image as AstroImage, type RemoteImageProps } from "astro:assets"

import { declareLet } from "@/utils/declareLet"

const MAX_WIDTH = 1080

type Props = RemoteImageProps & {
  priority?: boolean
}

let {
  src,
  width,
  height,
  alt = "image alt",
  priority = false,
  ...props
} = Astro.props

const size = declareLet(() => {
  let w = Number(width)
  let h = Number(height)

  if (w > MAX_WIDTH) {
    h *= MAX_WIDTH / w
    w = MAX_WIDTH
  }
  return { width: w, height: h }
})
---

<AstroImage
  alt={alt}
  height={size.height}
  sizes="(max-width: 768px) 100vw, 50vw"
  src={src}
  width={size.width}
  {...priority && { loading: "eager", fetchpriority: "high" }}
  {...props}
/>
