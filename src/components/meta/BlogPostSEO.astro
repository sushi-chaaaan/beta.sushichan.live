---
import type { CollectionEntry } from "astro:content"
import { SEO } from "astro-seo"

import { cloudinaryOGPLoader } from "@/lib/cloudinary"
import { dtTool } from "@/lib/date"

type Props = {
  entry: CollectionEntry<"posts">
  isPreview?: boolean
}

const {
  entry: { data },
  isPreview = false,
} = Astro.props

const createdAt = dtTool.replaceTzWithJst(data.createdAt).toISOString()
const updatedAt = data.updatedAt
  ? dtTool.replaceTzWithJst(data.updatedAt).toISOString()
  : undefined

const optimizedOGPImage = cloudinaryOGPLoader(data.thumbnail)
---

<SEO
  openGraph={{
    basic: {
      title: data.title,
      type: "article",
      image: optimizedOGPImage,
    },
    image: {
      url: optimizedOGPImage,
      width: 1200,
      height: 630,
      alt: data.title,
    },
    article: {
      publishedTime: createdAt,
      modifiedTime: updatedAt,
      tags: data.tags,
    },
    optional: {
      description: data.description,
      locale: "ja_JP",
      siteName: "すしにっき",
    },
  }}
  twitter={{
    title: data.title,
    description: data.description,
    card: "summary_large_image",
    image: optimizedOGPImage,
    creator: "@sushichan_044",
  }}
  description={data.description}
  title={data.title}
  titleDefault="すしにっき"
  titleTemplate="%s - すしにっき"
  {...isPreview && {
    nofollow: true,
    noindex: true,
  }}
/>
