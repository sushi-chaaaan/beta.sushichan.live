---
import type { CollectionEntry } from "astro:content"

import Link from "@/components/base/Link.astro"
import BudouX from "@/components/common/BudouX.astro"
import CloudinaryImage from "@/components/ui/CloudinaryImage.astro"
import { dtTool } from "@/lib/date"

type Props = {
  post: CollectionEntry<"posts">
}

const { post } = Astro.props

const createdAt = dtTool.replaceTzWithJst(post.data.createdAt)
const createdAtSring = dtTool.formatInJst(createdAt, "yyyy/MM/dd")
---

<article
  class:list={[
    "overflow-hidden rounded-lg bg-custom-theme-light outline outline-1 outline-slate-700 dark:bg-custom-theme-dark dark:outline-slate-400",
    "group/article",
    post.data.status !== "published" && "bg-yellow-500 dark:bg-yellow-700",
  ]}
  transition:animate="fade"
  transition:name={`card-${post.slug}`}
>
  <Link href={`/blog/post/${post.slug}`} variants={{ decoration: "none" }}>
    <div class="flex h-full flex-col flex-nowrap gap-2 pb-5 text-center">
      <div
        class="aspect-16/9 overflow-hidden rounded-t-[calc(0.5rem-1px)]"
        data-image
      >
        <CloudinaryImage
          class:list={[
            "h-full w-full object-cover",
            "transition-transform duration-1000 ease-in-out will-change-transform",
            "group-hover/article:scale-105",
          ]}
          alt={`thumbnail of ${post.slug}`}
          src={post.data.thumbnail}
          priority
        />
      </div>
      <time datetime={createdAt.toISOString()}>{createdAtSring}</time>
      <h2
        class="inline-block px-2 text-xl font-bold"
        transition:animate="fade"
        transition:name={`title-${post.slug}`}
      >
        <BudouX>
          {post.data.title}
        </BudouX>
      </h2>
    </div>
  </Link>
</article>
