---
import type { CollectionEntry } from "astro:content"

import { getPostOgpImage } from "@/features/blog/utils/post"
import { dtTool } from "@/lib/date"
import { SEO } from "astro-seo"

type Props = {
  entry: CollectionEntry<"posts">
  isPreview?: boolean
}

const {
  entry: { data, slug },
  isPreview = false,
} = Astro.props

const createdAt = dtTool.replaceUtcWithJst(data.createdAt).toISOString()
const updatedAt = data.updatedAt
  ? dtTool.replaceUtcWithJst(data.updatedAt).toISOString()
  : undefined

const OGPUrl = getPostOgpImage(slug, {
  baseUrl: Astro.url,
  extension: "png",
})
---

<SEO
  openGraph={{
    article: {
      modifiedTime: updatedAt,
      publishedTime: createdAt,
      tags: data.tags,
    },
    basic: {
      image: OGPUrl,
      title: data.title,
      type: "article",
    },
    optional: {
      description: data.description,
      locale: "ja_JP",
      siteName: "すしにっき",
    },
  }}
  twitter={{
    card: "summary_large_image",
    creator: "@sushichan_044",
    description: data.description,
    image: OGPUrl,
    title: data.title,
  }}
  description={data.description}
  title={data.title}
  titleDefault="すしにっき"
  titleTemplate="%s - すしにっき"
  {...isPreview && {
    nofollow: true,
    noindex: true,
  }}
/>
